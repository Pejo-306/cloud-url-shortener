# ADR-003: Data Durability and Backup Strategy

## Status

Accepted (Retroactively documented)

## Date

2025-12-21

## Context

The `cloudshortener` system uses **Redis Cloud** (with ability to upgrade to
**Redis Cloud Pro** at scale) as its primary datastore
([ADR-001](/docs/decisions/ADR-001-primary-datastore.md)).

Redis is an in-memory database, which provides excellent performance but introduces
data durability considerations in the event of:
- Node failure
- Cluster failure
- Operator error
- Regional outages

Relevant requirements and constraints:
- Data retention up to 1 year ([NFR-4](/docs/requirements.md#nfr-4-data-retention))
- High availability and reliability ([NFR-3](/docs/requirements.md#nfr-3-availability))
- Minimize operational complexity ([C-3](/docs/requirements.md#c-3-team-size))
- Use fully managed services where possible

The system does **NOT** require:
- Zero data loss (strong durability guarantees)
- Financial-grade durability guarantees
- Cross-region synchronous replication

However, prolonged data loss or full dataset loss would significantly impact
system correctness and user trust.

## Decision

Use **Redis Cloud Pro automatic backups** with the following configuration:

- **Automated full backups every 1 hour**
- Backups stored in **Amazon S3** (cheap and very highly durable)
- Backup retention managed by **Redis Cloud**
- Recovery via **Redis Cloud** restore mechanism

This approach provides approximately **99.999% (five nines) data durability**
for persisted data while maintaining low operational overhead.

## Rationale

Redis Cloud Pro provides a managed backup solution that:
- Requires no custom tooling or scheduling
- Leverages Amazon S3's high durability guarantees
- Allows point-in-time recovery with bounded data loss
- Aligns with the learning and operational goals of the project

Hourly backups provide a practical balance between:
- Acceptable data loss window
- Cost
- Simplicity

## Backup Strategy Comparison

| Strategy                          | Backup Frequency | Storage Medium | Durability Rating | Worst-Case Data Loss | Expected Data Loss / Year |
|----------------------------------|------------------|----------------|-------------------|----------------------|---------------------------|
| No backups                       | N/A              | N/A            | ~99.0%            | Total data loss      | Catastrophic              |
| Redis AOF only                   | Continuous       | Local disk     | ~99.9%            | Seconds–minutes      | Low, but node-bound       |
| Daily full backups               | 24h              | S3             | 99.99%            | Up to 24 hours       | Moderate                  |
| **Hourly Redis Cloud backups**   | **1h**           | **S3**         | **99.999%**       | **≤ 1 hour**         | **Low**                   |
| Multi-region active-active       | Near real-time   | Multi-region   | 99.9999%+         | Near-zero            | Very low                  |

**Notes:**
- Durability ratings are indicative and based on common cloud reliability models
- Expected data loss reflects *probabilistic loss over one year*, not worst-case events
- Multi-region replication was considered unnecessary for current system goals

I had manually calculated durability ratings to ensure 5 9s of durability, but lost the
physical paper with my calculations. So these options in the table are just generated by
chatGPT. May not be the most accurate. One things that is sure is that hourly Redis
Cloud Pro backups deliver 5 9s of durability for my system.

## Consequences

### Positive
- Strong durability guarantees without custom backup logic
- Low operational overhead
- Bounded and predictable data loss window
- Leverages Amazon S3’s durability guarantees
- Easy restore and disaster recovery

### Negative
- Potential loss of up to 1 hour of data in worst-case scenarios
- Backup and restore controlled by vendor tooling
- Additional cost for backup storage and operations

## Impact

This decision directly influences:
- Disaster recovery strategy
- Acceptable recovery point objective (RPO)
- Operational runbooks and restore procedures
- Decisions around replication and caching

Future decisions around multi-region deployments or stronger consistency guarantees
may revisit this strategy.